{%- if product.selected_or_first_available_variant.barcode != blank -%}

    {%- assign isBarCodeAvailable = true -%}

    {%- assign gtinStringLength = product.selected_or_first_available_variant.barcode | size -%}

    {%- if gtinStringLength == 8 or gtinStringLength == 12 or gtinStringLength == 13 or gtinStringLength == 14 -%}
        {%- assign isValidGtinLength = true -%}
        {%- assign gtinString = gtinString | append: gtinStringLength -%}
    {%- endif -%}

{%- endif -%}

{%- assign ratingValue = blank -%}


{% comment %} works if the review app is the shopify review app {% endcomment %}
    {%- assign ratingValueReviewArray = product.metafields.spr.reviews | split: '"ratingValue": "' -%}
    {%- assign ratingValueArr = ratingValueReviewArray[1] |split: '"' -%}
    {%- assign reviewValue = ratingValueArr[0] -%}
    {%- assign reviewsCountStrArray = product.metafields.spr.reviews | split: '"reviewCount": "' -%}
    {%- assign reviewsCountArr = reviewsCountStrArray[1] | split: '"' -%}
    {%- assign reviewsCount = reviewsCountArr[0] -%}
    {%- unless reviewsCount == blank -%}
        {%- assign reviewAppDescription = '"Shopify Product Reviews"' -%}
        {%- assign ratingValue = reviewValue -%}
        {%- assign reviewCount = reviewsCount -%}
    {%- endunless -%}

{%- assign variantsByPrice = product.variants | sort: 'price' -%}

















{%- capture product_json_ld -%}
<!--JSON-LD data generated by Custom SEO code -->
<script type="application/ld+json">
	
    {
        "@context": "https://schema.org/",
        "@type": "Product",
    {%- if isBarCodeAvailable and isValidGtinLength %}
        "{{gtinString}}": "{{product.selected_or_first_available_variant.barcode}}",
        "productId": "{{product.selected_or_first_available_variant.barcode}}",
    {%- elsif isBarCodeAvailable %}
        "productId": "{{product.selected_or_first_available_variant.barcode}}",
        "mpn": "{{product.selected_or_first_available_variant.barcode}}",
    {%- endif %}

        "url": "{{ shop.url | append: '/products/' | append: product.handle }}",
        "name": "{{product.title}}",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "116-15272 Croydon Drive",
          "addressLocality": "Surrey",
          "addressRegion": "BC",
          "postalCode": "V3S 0Z5",
          "addressCountry": "Canada"
        },
        "image": "https:{{ product.featured_image.src | img_url: "master" }}",
        "description": "Motorize your ideas using Electric Linear Actuators. Since 2002 FIRGELLIÂ® has been developing motion control actuators globally for thousands of applications.",
        "brand": {
                   "@type": "Brand",
                   "name": "Firgelli Automations"
                 },
    {%- if collection_urls != blank %}
        "category": [
            {{ collection_urls }}
        ],
    {%- endif %}
        
    {%- if product.selected_or_first_available_variant.sku != blank %}
        "sku": "{{product.selected_or_first_available_variant.sku}}",
        {%- if isBarCodeAvailable == false %}
        "mpn": "{{product.selected_or_first_available_variant.sku}}",
        {%- endif -%}
    {%- endif -%}
    {%- if product.selected_or_first_available_variant.weight != blank %}
        "weight": "{{ product.selected_or_first_available_variant.weight | weight_with_unit | replace: " ", "" }}",
    {%- endif -%}
        
    
    {%- if reviewAppDescription != blank and ratingValue and reviewCount %}
        "aggregateRating": {
            "@type": "AggregateRating",
            "description": {{ reviewAppDescription }},
            "ratingValue": "{{ ratingValue }}",
            "reviewCount": "{{ reviewCount }}",
            "priceCurrency": "{{- shop.currency -}}",
            "lowPrice": "{{- variantsByPrice.first.price | divided_by: 100.0 -}}",
            "highPrice": "{{- variantsByPrice.last.price | divided_by: 100.0 -}}"
        },
    {%- endif %}
        "offers": [
    {%- assign variant = product.selected_variant -%}
    {%- if variant %}
            {
                "@type": "Offer",
            {%- if isBarCodeAvailable and isValidGtinLength %}
                "{{gtinString}}": "{{variant.barcode}}",
            {%- elsif isBarCodeAvailable %}
                "mpn": "{{variant.barcode}}",
            {%- endif %}
                "priceCurrency": "{{ shop.currency }}",
            {%- assign decimalValue = variant.price | modulo: 100 %}{% if decimalValue < 10 %}{% assign decimalValue = decimalValue | prepend: "0" %}{% endif %}
                "price": "{{variant.price | divided_by: 100}}.{{decimalValue}}",
                "priceValidUntil": "{{"now" | date: "%s" | plus: daysProductPriceValidUntil | date: "%Y-%m-%d"}}",
                
                "availability": "https://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
                "itemCondition": "https://schema.org/NewCondition",

            {%- if variant.sku != blank %}
                "sku": "{{ variant.sku }}",
            {%- endif -%}
            {%- if variant.title != "Default Title" %}
                "name": "{{ variant.title | strip_newlines | strip_html | escape_once | replace: '\', '\\\\' }}",
            {%- endif %}
                "url": "{{ shop.url | append: variant.url }}",
                "seller": {
                    "@type": "Organization",
                    "name": "{{ shop.name | strip_newlines | strip_html | escape_once | replace: '\', '\\\\' }}"
                }
            }
    {%- else -%}
    {%- for variant in product.variants -%}
            {% if forloop.first == false %},{% endif %}
            {
                "@type": "Offer",
            {%- if isBarCodeAvailable and isValidGtinLength %}
                "{{gtinString}}": "{{variant.barcode}}",
            {%- elsif isBarCodeAvailable %}
                "mpn": "{{variant.barcode}}",
            {%- endif %}
                "priceCurrency": "{{ cart.currency.iso_code }}",
            {%- assign decimalValue = variant.price | modulo: 100 %}{% if decimalValue < 10 %}{% assign decimalValue = decimalValue | prepend: "0" %}{% endif %}
                "price": "{{variant.price | divided_by: 100}}.{{decimalValue}}",
                "priceValidUntil": "{{"now" | date: "%s" | plus: daysProductPriceValidUntil | date: "%Y-%m-%d"}}",
                "availability": "https://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
                "itemCondition": "https://schema.org/NewCondition",
                
            {%- if variant.sku != blank %}
                "sku": "{{ variant.sku }}",
            {%- endif -%}
            {%- if variant.title != "Default Title" %}
                "name": "{{ variant.title | strip_newlines | strip_html | escape_once | replace: '\', '\\\\' }}",
            {%- endif %}
                "url": "{{ shop.url | append: variant.url }}",
                "seller": {
                    "@type": "Organization",
                    "name": "{{ shop.name | strip_newlines | strip_html | escape_once | replace: '\', '\\\\' }}"
                }
            }
    {%- endfor %}
    {%- endif -%}
        ]
    }
</script>





{%- endcapture %}


{{ product_json_ld }}